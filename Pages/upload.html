<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Teacher Upload Portal</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-button">‚¨Ö Back to Home</a>
        <h1>Teacher Upload Portal</h1>
        
        <div id="uploadForm" class="explanation-box" style="text-align: left;">
            <label>Resource Category:</label>
            <select id="resourceCategory" style="width:100%; margin-bottom:10px;">
                <option value="file">üìÑ Printable File (PDF/Docs)</option>
                <option value="link">üé• YouTube or External Link</option>
            </select>

            <label>Resource Title:</label>
            <input type="text" id="fileTitle" placeholder="e.g. Irregular Verbs List" style="width:100%; margin-bottom:10px;">

            <label>Topic:</label>
            <select id="fileTopic" style="width:100%; margin-bottom:10px;">
                <option value="">All Topics</option>
                <option value="grammar">Grammar</option>
                <option value="vocabulary">Vocabulary</option>
                <option value="reading">Reading</option>
                <option value="writing">Writing</option>
                <option value="speaking">Speaking</option>
                <option value="listening">Listening</option>
                <option value="phonics">Phonics</option>
                <option value="exam prep">Exam Prep</option>
                <option value="business english">Business English</option>
                <option value="general">General</option>
            </select>

            <div id="fileUploadSection">
                <label>Select File (Max 5MB):</label>
                <input type="file" id="filePicker" accept=".pdf,.doc,.docx,.png,.jpg" style="margin-bottom:10px;">
            </div>

            <div id="linkUploadSection" style="display:none;">
                <label>Paste Link (YouTube or Website):</label>
                <input type="url" id="externalUrl" placeholder="https://www.youtube.com/watch?v=..." style="width:100%; margin-bottom:10px;">
            </div>

            <label>Material Type:</label>
            <select id="fileType" style="width:100%; margin-bottom:10px;">
                <option value="">All Types</option>
                <option value="PDF">PDF / Worksheet</option>
                <option value="video">Video</option>
                <option value="image">Infographic</option>
                <option value="PowerPoint">PowerPoint</option>
                <option value="website">Website</option>
                <option value="printable">Printable</option>
                <option value="interactive">Interactive</option>
            </select>

            <label>Target Age Group:</label>
            <select id="fileAge" style="width:100%; margin-bottom:10px;">
                <option value="">All Ages</option>
                <option value="children">Children</option>
                <option value="teens">Teens</option>
                <option value="adults">Adults</option>
            </select>

            <label>Teacher Name:</label>
            <input type="text" id="teacherName" placeholder="Your Name" style="width:100%; margin-bottom:20px;">

            <button id="uploadBtn" style="width:100%; padding:10px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                üöÄ Add to Library
            </button>
            <p id="status" style="margin-top:10px; font-weight:bold;"></p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCVNUfj11PBHmjoPmDtudky9z6MHAdCsLw",
            authDomain: "one-stop-shop-5e668.firebaseapp.com",
            projectId: "one-stop-shop-5e668",
            storageBucket: "one-stop-shop-5e668.firebasestorage.app",
            messagingSenderId: "158039043020",
            appId: "1:158039043020:web:424c94c7feda5b3004cb69"
        };

        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);
        const db = getFirestore(app);

        const uploadBtn = document.getElementById('uploadBtn');
        const status = document.getElementById('status');
        const categorySelect = document.getElementById('resourceCategory');
        const fileSection = document.getElementById('fileUploadSection');
        const linkSection = document.getElementById('linkUploadSection');

        // 4. Toggle visibility based on category choice
        categorySelect.addEventListener('change', (e) => {
            const isLink = e.target.value === 'link';
            fileSection.style.display = isLink ? 'none' : 'block';
            linkSection.style.display = isLink ? 'block' : 'none';
        });

        // 5. Unified Upload Logic
        uploadBtn.addEventListener('click', async () => {
            const category = categorySelect.value;
            const title = document.getElementById('fileTitle').value;
            const topic = document.getElementById('fileTopic').value;
            const teacher = document.getElementById('teacherName').value;
            const type = document.getElementById('fileType').value;
            const age = document.getElementById('fileAge').value;

            if (!title || !teacher) {
                alert("Please fill in the title and your name!");
                return;
            }

            uploadBtn.disabled = true;
            status.innerText = "‚è≥ Processing... please wait.";

            try {
                if (category === 'file') {
                    // --- FILE MODE: Upload to Storage ---
                    const file = document.getElementById('filePicker').files[0];
                    if (!file) throw new Error("Please select a file.");
                    if (file.size > 5 * 1024 * 1024) throw new Error("File too big (Max 5MB).");

                    const storagePath = `printables/${Date.now()}_${file.name}`;
                    const storageRef = ref(storage, storagePath);
                    const snapshot = await uploadBytes(storageRef, file);
                    const downloadURL = await getDownloadURL(snapshot.ref);

                    // Save to 'printables' collection
                    await addDoc(collection(db, "printables"), {
                        title, topic, teacher, type, ageGroup: age,
                        url: downloadURL, storagePath, createdAt: new Date()
                    });
                } else {
                    // --- LINK MODE: Save URL directly ---
                    const linkUrl = document.getElementById('externalUrl').value;
                    if (!linkUrl) throw new Error("Please paste a URL.");

                    // Save to 'resources' collection for your YouTube library
                    await addDoc(collection(db, "resources"), {
                        title, topic, teacher, type, ageGroup: age,
                        url: linkUrl, createdAt: new Date()
                    });
                }

                status.innerText = "‚úÖ Success! Added to the library.";
                document.getElementById('fileTitle').value = "";
                if(document.getElementById('externalUrl')) document.getElementById('externalUrl').value = "";
                
            } catch (error) {
                console.error(error);
                status.innerText = "‚ùå Error: " + error.message;
            } finally {
                uploadBtn.disabled = false;
            }
        });
    </script>
</body>
</html>